(window.webpackJsonp=window.webpackJsonp||[]).push([[6],{252:function(s,e,a){s.exports=a.p+"assets/img/bg2016010602.34c744d0.png"},253:function(s,e,a){s.exports=a.p+"assets/img/bg2016010604.510afed6.png"},254:function(s,e,a){s.exports=a.p+"assets/img/bg2016010605.04fbff99.png"},269:function(s,e,a){"use strict";a.r(e);var t=a(28),n=Object(t.a)({},(function(){var s=this,e=s.$createElement,t=s._self._c||e;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h1",{attrs:{id:"commit规范"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#commit规范"}},[s._v("#")]),s._v(" commit规范")]),s._v(" "),t("h2",{attrs:{id:"优雅的提交commit-log"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#优雅的提交commit-log"}},[s._v("#")]),s._v(" 优雅的提交commit log")]),s._v(" "),t("p",[s._v("一般来说，commit message 应该清晰明了，说明本次提交的目的。\n"),t("img",{attrs:{src:a(252),alt:"The Feathers chat application"}})]),s._v(" "),t("p",[s._v("社区有多种 Commit message 的写法规范。本文介绍Angular 规范（见上图），这是目前使用最广的写法，比较合理和系统化，并且有配套的工具。")]),s._v(" "),t("h2",{attrs:{id:"一、commit-message-的作用"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#一、commit-message-的作用"}},[s._v("#")]),s._v(" 一、Commit message 的作用")]),s._v(" "),t("p",[s._v("格式化的Commit message，有几个好处。")]),s._v(" "),t("p",[s._v("（1）提供更多的历史信息，方便快速浏览。")]),s._v(" "),t("p",[s._v("比如，下面的命令显示上次发布后的变动，每个commit占据一行。你只看行首，就知道某次 commit 的目的。")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("$ git log <last tag> HEAD --pretty=format:%s\n\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("p",[t("img",{attrs:{src:a(253),alt:"The Feathers chat application"}}),s._v("\n（2）可以过滤某些commit（比如文档改动），便于快速查找信息。")]),s._v(" "),t("p",[s._v("比如，下面的命令仅仅显示本次发布新增加的功能。")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("$ git log <last release> HEAD --grep feature\n\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("p",[s._v("Change Log 是发布新版本时，用来说明与上一个版本差异的文档，详见后文。")]),s._v(" "),t("h2",{attrs:{id:"commit-message-格式"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#commit-message-格式"}},[s._v("#")]),s._v(" Commit Message 格式")]),s._v(" "),t("p",[s._v("目前规范使用较多的是 Angular 团队的规范, 继而衍生了 Conventional Commits specification. 很多工具也是基于此规范, 它的 message 格式如下:")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("<type>(<scope>): <subject>\n// 空一行\n<body>\n// 空一行\n<footer>\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])]),t("p",[s._v("其中，Header 是必需的，Body 和 Footer 可以省略。\n不管是哪一个部分，任何一行都不得超过72个字符（或100个字符）。这是为了避免自动换行影响美观")]),s._v(" "),t("h3",{attrs:{id:"header"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#header"}},[s._v("#")]),s._v(" Header")]),s._v(" "),t("p",[s._v("Header部分只有一行，包括三个字段：type（必需）、scope（可选）和subject（必需）。")]),s._v(" "),t("p",[s._v("（1）type")]),s._v(" "),t("p",[s._v("type用于说明 commit 的类别，只允许使用下面7个标识。")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("feat：新功能（feature）\nfix：修补bug\ndocs：文档（documentation）\nstyle： 格式（不影响代码运行的变动）\nrefactor：重构（即不是新增功能，也不是修改bug的代码变动）\ntest：增加测试\nchore：构建过程或辅助工具的变动\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br")])]),t("p",[s._v("如果type为feat和fix，则该 commit 将肯定出现在 Change log 之中。其他情况（docs、chore、style、refactor、test）由你决定，要不要放入 Change log，建议是不要。")]),s._v(" "),t("p",[s._v("（2）scope")]),s._v(" "),t("p",[s._v("scope用于说明 commit 影响的范围，比如数据层、控制层、视图层等等，视项目不同而不同。")]),s._v(" "),t("p",[s._v("（3）subject")]),s._v(" "),t("p",[s._v("subject是 commit 目的的简短描述，不超过50个字符。")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("以动词开头，使用第一人称现在时，比如change，而不是changed或changes\n第一个字母小写\n结尾不加句号（.）\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("h3",{attrs:{id:"body"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#body"}},[s._v("#")]),s._v(" body")]),s._v(" "),t("p",[s._v("Body 部分是对本次 commit 的详细描述，可以分成多行。下面是一个范例。")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("More detailed explanatory text, if necessary.  Wrap it to \nabout 72 characters or so. \n\nFurther paragraphs come after blank lines.\n\n- Bullet points are okay, too\n- Use a hanging indent\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br")])]),t("p",[s._v("有两个注意点。")]),s._v(" "),t("p",[s._v("（1）使用第一人称现在时，比如使用change而不是changed或changes。")]),s._v(" "),t("p",[s._v("（2）应该说明代码变动的动机，以及与以前行为的对比。")]),s._v(" "),t("h3",{attrs:{id:"footer"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#footer"}},[s._v("#")]),s._v(" Footer")]),s._v(" "),t("p",[s._v("Footer 部分只用于两种情况。")]),s._v(" "),t("p",[s._v("（1）不兼容变动")]),s._v(" "),t("p",[s._v("如果当前代码与上一个版本不兼容，则 Footer 部分以BREAKING CHANGE开头，后面是对变动的描述、以及变动理由和迁移方法。\nBREAKING CHANGE: isolate scope bindings definition has changed.")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("    To migrate the code follow the example below:\n\n    Before:\n\n    scope: {\n      myAttr: 'attribute',\n    }\n\n    After:\n\n    scope: {\n      myAttr: '@',\n    }\n\n    The removed `inject` wasn't generaly useful for directives so there should be no code using it.```\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br")])]),t("p",[s._v("（2）关闭 Issue")]),s._v(" "),t("p",[s._v("如果当前 commit 针对某个issue，那么可以在 Footer 部分关闭这个 issue 。")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("Closes #234\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("也可以一次关闭多个 issue 。")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("Closes #123, #245, #992\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("h3",{attrs:{id:"revert"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#revert"}},[s._v("#")]),s._v(" Revert")]),s._v(" "),t("p",[s._v("还有一种特殊情况，如果当前 commit 用于撤销以前的 commit，则必须以revert:开头，后面跟着被撤销 Commit 的 Header。")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("\nrevert: feat(pencil): add 'graphiteWidth' option\n\nThis reverts commit 667ecc1654a317a13331b17617d973392f415f02.\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("p",[s._v("Body部分的格式是固定的，必须写成This reverts commit <hash>.，其中的hash是被撤销 commit 的 SHA 标识符。")]),s._v(" "),t("p",[s._v("如果当前 commit 与被撤销的 commit，在同一个发布（release）里面，那么它们都不会出现在 Change log 里面。如果两者在不同的发布，那么当前 commit，\n会出现在 Change log 的Reverts小标题下面。")]),s._v(" "),t("h2",{attrs:{id:"commitizen"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#commitizen"}},[s._v("#")]),s._v(" commitizen")]),s._v(" "),t("p",[s._v("Commitizen是一个撰写合格 Commit message 的工具。\n安装命令如下。")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("$ npm install -g commitizen\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("然后，在项目目录里，运行下面的命令，使其支持 Angular 的 Commit message 格式。")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("$ commitizen init cz-conventional-changelog --save --save-exact\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("以后，凡是用到git commit命令，一律改为使用git cz。这时，就会出现选项，用来生成符合格式的 Commit message。\n"),t("img",{attrs:{src:a(254),alt:"The Feathers chat application"}})]),s._v(" "),t("h2",{attrs:{id:"校验你的-message"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#校验你的-message"}},[s._v("#")]),s._v(" 校验你的 message")]),s._v(" "),t("p",[t("a",{attrs:{href:"https://github.com/kentcdodds/validate-commit-msg",target:"_blank",rel:"noopener noreferrer"}},[s._v("validate-commit-msg"),t("OutboundLink")],1),s._v(" 用于检查 Node 项目的 Commit message 是否符合格式。")]),s._v(" "),t("p",[s._v("它的安装是手动的。首先，拷贝下面这个"),t("a",{attrs:{href:"https://github.com/conventional-changelog-archived-repos/validate-commit-msg/blob/master/index.js",target:"_blank",rel:"noopener noreferrer"}},[s._v("JS文件"),t("OutboundLink")],1),s._v("，\n放入你的代码库。文件名可以取为validate-commit-msg.js。")]),s._v(" "),t("p",[s._v("接着，把这个脚本加入 Git 的 hook。下面是在package.json里面使用 ghooks，把这个脚本加为commit-msg时运行。")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v('  "config": {\n    "ghooks": {\n      "commit-msg": "./validate-commit-msg.js"\n    }\n  }\n')])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])]),t("p",[s._v("然后，每次git commit的时候，这个脚本就会自动检查 Commit message 是否合格。如果不合格，就会报错。")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v('$ git add -A \n$ git commit -m "edit markdown" \nINVALID COMMIT MSG: does not match "<type>(<scope>): <subject>" ! was: edit markdown\n')])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])])])}),[],!1,null,null,null);e.default=n.exports}}]);